<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Split and re-merge RasterLayer(s) — mergeRaster â€¢ SpaDES.tools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">SpaDES.tools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/SpaDES.tools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Split and re-merge RasterLayer(s)</h1>
    </div>

    
    <p><code>splitRaster</code> divides up a raster into an arbitrary number of pieces (tiles).
Split rasters can be recombined using <code>do.call(merge, y)</code> or <code>mergeRaster(y)</code>,
where <code>y &lt;- splitRaster(x)</code>.</p>
    

    <pre><span class='fu'>mergeRaster</span>(<span class='no'>x</span>)

<span class='co'># S4 method for list</span>
<span class='fu'>mergeRaster</span>(<span class='no'>x</span>)

<span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='kw'>nx</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>ny</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>buffer</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>0</span>),
  <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='fu'>getwd</span>(), <span class='fu'>names</span>(<span class='no'>r</span>)), <span class='no'>cl</span>)

<span class='co'># S4 method for RasterLayer</span>
<span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='kw'>nx</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>ny</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>buffer</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>0</span>),
  <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='fu'>getwd</span>(), <span class='fu'>names</span>(<span class='no'>r</span>)), <span class='no'>cl</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>x</dt>
      <dd><p>A list of split raster tiles (i.e., from <code>splitRaster</code>).</p></dd>
      <dt>r</dt>
      <dd><p>The raster to be split.</p></dd>
      <dt>nx</dt>
      <dd><p>The number of tiles to make along the x-axis.</p></dd>
      <dt>ny</dt>
      <dd><p>The number of tiles to make along the y-axis.</p></dd>
      <dt>buffer</dt>
      <dd><p>Numeric vector of length 2 giving the size of the buffer along the x and y axes.
If these values less than or equal to <code>1</code> are used, this
is interpreted as the number of pixels (cells) to use as a buffer.
Values between <code>0</code> and <code>1</code> are interpreted as proportions
of the number of pixels in each tile (rounded up to an integer value).
Default is <code>c(0, 0)</code>, which means no buffer.</p></dd>
      <dt>path</dt>
      <dd><p>Character specifying the directory to which the split tiles will be saved.
If missing, the function creates a subdirectory in the current
working directory based on the raster's name (i.e., using <code>names(x)</code>).</p></dd>
      <dt>cl</dt>
      <dd><p>A cluster object. Optional. This would generally be created using
parallel::makeCluster or equivalent. This is an alternative way, instead
of <code>beginCluster()</code>, to use parallelism for this function, allowing for
more control over cluster use.</p></dd>
    </dl>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>mergeRaster</code> returns a <code>RasterLayer</code> object.

<code>splitRaster</code> returns a list (length <code>nx*ny</code>) of cropped raster tiles.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>mergeRaster</code> differs from <code>merge</code> in how overlapping tile
regions are handled: <code>merge</code> retains the values of the first raster in
the list. This has the consequence of retaining the values from the buffered
region in the first tile in place of the values from the neighbouring tile.
On the other hand, <code>mergeRaster</code> retains the values of the tile region,
over the values in any buffered regions. This is useful for reducing edge
effects when performing raster operations involving contagious processes.
To use the average of cell values, or do another computation, use
<code><a href='http://www.rdocumentation.org/packages/raster/topics/mosaic'>mosaic</a></code>.</p>
<p>This function is parallel-aware, using the same mechanism as used in the <code>raster</code>
package. Specifically, if you start a cluster using <code>beginCluster</code>, then
this function will automatically use that cluster. It is always a good
idea to stop the cluster when finished, using <code>endCluster</code>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='http://www.rdocumentation.org/packages/raster/topics/merge'>merge</a></code>, <code><a href='http://www.rdocumentation.org/packages/raster/topics/mosaic'>mosaic</a></code>
    <code>do.call</code>, <code><a href='http://www.rdocumentation.org/packages/raster/topics/merge'>merge</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>raster</span>)

<span class='co'># an example with dimensions:</span>
<span class='co'># nrow: 77</span>
<span class='co'># ncol: 101</span>
<span class='co'># nlayers: 3</span>
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>brick</span>(<span class='fu'>system.file</span>(<span class='st'>"external/rlogo.grd"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"raster"</span>))
<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='no'>b</span><span class='kw'>[[</span><span class='fl'>1</span>]] <span class='co'># use first layer only</span>
<span class='no'>nx</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>ny</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span>

<span class='no'>tmpdir</span> <span class='kw'>&lt;-</span> <span class='fu'>file.path</span>(<span class='fu'>tempdir</span>(), <span class='st'>"splitRaster-example"</span>)
<span class='fu'>dir.create</span>(<span class='no'>tmpdir</span>)

<span class='no'>y0</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='no'>tmpdir</span>, <span class='st'>"y0"</span>)) <span class='co'># no buffer</span>

<span class='co'># buffer: 10 pixels along both axes</span>
<span class='no'>y1</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='fu'>c</span>(<span class='fl'>10</span>, <span class='fl'>10</span>), <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='no'>tmpdir</span>, <span class='st'>"y1"</span>))

<span class='co'># buffer: half the width and length of each tile</span>
<span class='no'>y2</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='fu'>c</span>(<span class='fl'>0.5</span>, <span class='fl'>0.5</span>), <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='no'>tmpdir</span>, <span class='st'>"y2"</span>))

<span class='co'># parallel cropping</span>
<span class='kw'>if</span> (<span class='fu'>interactive</span>()) {
  <span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fu'>pmin</span>(<span class='kw'>parallel</span><span class='kw'>::</span><span class='fu'>detectCores</span>(), <span class='fl'>4</span>) <span class='co'># use up to 4 cores</span>
  <span class='fu'>beginCluster</span>(<span class='no'>n</span>)
  <span class='no'>y3</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='fu'>c</span>(<span class='fl'>0.7</span>, <span class='fl'>0.7</span>), <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='no'>tmpdir</span>, <span class='st'>"y3"</span>))
  <span class='fu'>endCluster</span>()
}

<span class='co'># the original raster:</span>
<span class='kw'>if</span> (<span class='fu'>interactive</span>()) <span class='fu'>plot</span>(<span class='no'>r</span>) <span class='co'># may require a call to `dev()` if using RStudio</span></div><img src='mergeRaster-2.png' alt='' width='540' height='400' /><div class='input'>
<span class='co'># the split raster:</span>
<span class='fu'>layout</span>(<span class='kw'>mat</span> <span class='kw'>=</span> <span class='fu'>matrix</span>(<span class='fu'>seq_len</span>(<span class='no'>nx</span> * <span class='no'>ny</span>), <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='no'>nx</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='no'>ny</span>))
<span class='no'>plotOrder</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>4</span>, <span class='fl'>8</span>, <span class='fl'>12</span>, <span class='fl'>3</span>, <span class='fl'>7</span>, <span class='fl'>11</span>, <span class='fl'>2</span>, <span class='fl'>6</span>, <span class='fl'>10</span>, <span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>9</span>)
<span class='kw'>if</span> (<span class='fu'>interactive</span>()) <span class='fu'>invisible</span>(<span class='fu'>lapply</span>(<span class='no'>y0</span>[<span class='no'>plotOrder</span>], <span class='no'>plot</span>))</div><div class='output co'>#&gt; <span class='warning'>Warning: no non-missing arguments to min; returning Inf</span></div><div class='output co'>#&gt; <span class='warning'>Warning: no non-missing arguments to max; returning -Inf</span></div><div class='output co'>#&gt; <span class='warning'>Warning: no non-missing arguments to min; returning Inf</span></div><div class='output co'>#&gt; <span class='warning'>Warning: no non-missing arguments to max; returning -Inf</span></div><div class='output co'>#&gt; <span class='error'>Error in plot.window(...): need finite 'xlim' values</span></div><div class='input'>
<span class='co'># can be recombined using `raster::merge`</span>
<span class='no'>m0</span> <span class='kw'>&lt;-</span> <span class='fu'>do.call</span>(<span class='no'>merge</span>, <span class='no'>y0</span>)
<span class='fu'>all.equal</span>(<span class='no'>m0</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>do.call</span>(<span class='no'>merge</span>, <span class='no'>y1</span>)
<span class='fu'>all.equal</span>(<span class='no'>m1</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>m2</span> <span class='kw'>&lt;-</span> <span class='fu'>do.call</span>(<span class='no'>merge</span>, <span class='no'>y2</span>)
<span class='fu'>all.equal</span>(<span class='no'>m2</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># or recombine using mergeRaster</span>
<span class='no'>n0</span> <span class='kw'>&lt;-</span> <span class='fu'>mergeRaster</span>(<span class='no'>y0</span>)
<span class='fu'>all.equal</span>(<span class='no'>n0</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>n1</span> <span class='kw'>&lt;-</span> <span class='fu'>mergeRaster</span>(<span class='no'>y1</span>)
<span class='fu'>all.equal</span>(<span class='no'>n1</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>n2</span> <span class='kw'>&lt;-</span> <span class='fu'>mergeRaster</span>(<span class='no'>y2</span>)
<span class='fu'>all.equal</span>(<span class='no'>n2</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='fu'>unlink</span>(<span class='no'>tmpdir</span>, <span class='kw'>recursive</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><img src='mergeRaster-22.png' alt='' width='540' height='400' /></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Yong Luo and Alex Chubaty

Alex Chubaty and Yong Luo

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
